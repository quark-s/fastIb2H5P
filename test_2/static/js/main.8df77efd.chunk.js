(this.webpackJsonpPreview=this.webpackJsonpPreview||[]).push([[0],{10:function(e,t,n){},11:function(e,t,n){},17:function(e,t,n){"use strict";n.r(t);var i=n(1),s=n.n(i),r=n(4),o=n.n(r);n(10),n(11);class a{constructor(){this.playerReadyListener="noListener",this.preloadReturnListener="noListener",this.getUserIdReturnListener="noListener",this.loginDialogClosedListener="noListener",this.getTaskReturnListener="noListener",this.getScoringResultReturnListener="noListener",this.traceLogListener="noListener",this.recordingListener="noListener",this.getTasksStateReturnListener="noListener",this.taskSwitchRequestListener="noListener",this.getScoringResultListener="noListener",this.getTaskStateListener="noListener",this.shinyTaskSwitchRequestListener="noListener",this.shinyPreloadStateListener="noListener",this.shinyClearStateListener="noListener"}startReceiving(){window.addEventListener("message",e=>{this.processMessageEvent(e)})}setPlayerReadyListener(e){this.playerReadyListener=e}setPreloadReturnListener(e){this.preloadReturnListener=e}setGetUserIdReturnListener(e){this.getUserIdReturnListener=e}setLoginDialogClosedListener(e){this.loginDialogClosedListener=e}setGetTaskReturnListener(e){this.getTaskReturnListener=e}setGetScoringResultReturnListener(e){this.getScoringResultReturnListener=e}setTraceLogListener(e){this.traceLogListener=e}setRecordingListener(e){this.recordingListener=e}setGetTasksStateReturnListener(e){this.getTasksStateReturnListener=e}setTaskSwitchRequestListener(e){this.taskSwitchRequestListener=e}setGetScoringResultListener(e){this.getScoringResultListener=e}setShinyTaskSwitchRequestListener(e){this.shinyTaskSwitchRequestListener=e}setShinyPreloadStateListener(e){this.shinyPreloadStateListener=e}setGetTaskStateListener(e){this.getTaskStateListener=e}processMessageEvent(e){const{origin:t,data:n,source:i}=e;if(null===i)return void console.warn("Ignoring message without source.");if(t!==window.origin)return void console.warn("Ignoring message from wrong origin. Message origin is ".concat(t,". Accepted origin is ").concat(window.origin,"."));if(i===window.parent&&"object"===typeof n){if(!n.type)return;return void("navigate_to"===n.type&&"noListener"!==this.shinyTaskSwitchRequestListener?this.shinyTaskSwitchRequestListener(i,n.request):"preload_state"===n.type&&"noListener"!==this.shinyPreloadStateListener?this.shinyPreloadStateListener(i,n.request):"getScoringResult"===n.type&&"noListener"!==this.getScoringResultListener?this.getScoringResultListener(i,JSON.stringify(n)):"getTasksState"===n.type&&"noListener"!==this.getTaskStateListener&&this.getTaskStateListener(i,JSON.stringify(n)))}let s;try{s=JSON.parse(n)}catch(o){return void console.info("Ignoring message with non-JSON data: ".concat(n))}const r=s.eventType;if("taskPlayerReady"!==r||"noListener"===this.playerReadyListener){if("setPreloadReturn"===r&&"noListener"!==this.preloadReturnListener){const e={isSuccess:s.isSuccess,message:s.message};return void this.preloadReturnListener(i,e)}if("getUserIdReturn"!==r||"noListener"===this.getUserIdReturnListener)if("loginDialogClosed"!==r||"noListener"===this.loginDialogClosedListener)if("getTaskReturn"!==r||"noListener"===this.getTaskReturnListener)if("getScoringResultReturn"!==r||"noListener"===this.getScoringResultReturnListener){if("traceLogTransmission"===r&&"noListener"!==this.traceLogListener){const{metaData:e,logEntriesList:t}=s.traceLogData;return console.log(s.traceLogData),void this.traceLogListener(i,JSON.stringify(e),t.map(e=>JSON.stringify(e)))}if("recordingTransmission"===r&&"noListener"!==this.recordingListener){const{metaData:e,recordingEntriesList:t}=s.recordingData;return void this.recordingListener(i,JSON.stringify(e),t.map(e=>JSON.stringify(e)))}if("getTasksStateReturn"===r&&"noListener"!==this.getTasksStateReturnListener){const{userId:e,state:t}=s;return void this.getTasksStateReturnListener(i,e,JSON.stringify(t))}if("taskSwitchRequest"===r&&"noListener"!==this.taskSwitchRequestListener){const{request:e,scope:t,item:n,task:r}=s;return void this.taskSwitchRequestListener(i,e,"goToTask"===e?{scope:t,item:n,task:r}:void 0)}}else this.getScoringResultReturnListener(i,JSON.stringify(s.result));else this.getTaskReturnListener(i,{scope:s.scope,item:s.item,task:s.task});else this.loginDialogClosedListener(i,s.fieldValue);else this.getUserIdReturnListener(i,s.id)}else this.playerReadyListener(i)}}var c=n(2),l=n(19);function d(e,t){e.postMessage(JSON.stringify(t),{targetOrigin:"*"})}function u(){return g("./assessments/config.json").then(e=>{if(!function(e){try{return e.tasks&&Array.isArray(e.tasks)&&e.tasks.every(f)}catch(t){return!1}}(e))throw new Error("Assessment configuration is invalid: ".concat(JSON.stringify(e)));if(e.tasks.length<1)throw new Error("Assessment configuration contains no tasks: ".concat(JSON.stringify(e)));return console.log("Received assessment configuration",e),e})}function g(e){return new Promise((t,n)=>{const i=new XMLHttpRequest;i.responseType="json",i.onload=()=>t(i.response),i.onerror=()=>n(i.statusText),i.open("GET",e,!0),i.send()})}function h(e){let t={};if(window.document.location.search.length)try{document.location.search.replace("?","").split("&").forEach(n=>{let i=n.split("=");2===i.length&&e.indexOf(i[0])>=0&&(t[i[0]]=i[1])})}catch(n){console.error("error parsing query string: "+n)}return t}function f(e){try{return e.item&&"string"===typeof e.item&&e.task&&"string"===typeof e.task&&e.scope&&"string"===typeof e.scope}catch(t){return!1}}function y(e){try{return e.playerId&&"string"===typeof e.playerId&&e.runtimeVersion&&"string"===typeof e.runtimeVersion&&e.frameContentFile&&"string"===typeof e.frameContentFile}catch(t){return!1}}var p=n(5),m=n.n(p);function v(e,t,n,i,s){e.setTaskSwitchRequestListener((s,r,o)=>{const a=n.getPlayerId(s);if(void 0===a)return void console.warn("Received switch request from unknown task player frame. This is an internal error. We ignored the request.");const c=t.currentTask,l=function(e,t,n,i){switch(t){case"cancelTask":return i.cancel(e);case"nextTask":return i.nextTask(e);case"previousTask":return i.backTask(e);case"goToTask":return void 0===n?{type:"blocked",reason:"Task specification is missing in goToTask request."}:i.goToTask(e,n);default:return t}}(a,r,o,t);switch(l.type){case"blocked":return console.log("Cannot follow switch request ".concat(r,": ").concat(l.reason,". We ignored the request.")),void("nextTask"===r&&(d(s,{eventType:"getScoringResult"}),e.setGetScoringResultReturnListener((t,n)=>{window.postMessage(JSON.stringify({eventType:"progress_endOfSequence"}),"*"),e.setGetScoringResultReturnListener((e,t)=>{})})));case"login":return void function(e,t,n,i){const s=function(e,t,n,i){if(void 0===e)return{id:t,frameWindow:n};const s=i.getFrameWindow(e);if(void 0===s)return console.log("Advised player for request is not regitered. We use the triggering player instead."),{id:t,frameWindow:n};return{id:e,frameWindow:s}}(e,t,n,i);L(n),i.doToAll(e=>{!function(e){d(e,{eventType:"logout"})}(e)}),i.show(s.id),b(s.frameWindow)}(l.playerId,a,s,n);case"taskSwitch":return d(s,{eventType:"getScoringResult",requestId:"".concat(null===c||void 0===c?void 0:c.item,".").concat(null===c||void 0===c?void 0:c.task)}),void function(e,t,n,i,s,r){const o=s.getVersion(t.item);if(void 0===o)return void console.warn("Received task switch request to unknown item ".concat(t.item,". We ignored the request."));const a=I(e,o,{id:n,frameWindow:i},r);if(void 0===a)return void console.warn("Received task switch request to item ".concat(t.item," with version ").concat(o," and could not find a compatible task player. We ignored the request."));L(i),d(i,{eventType:"clearTasksState"}),r.show(a.id),R(t,a.frameWindow)}(l.playerId,l.nextTask,a,s,i,n);default:return l}}),e.setShinyTaskSwitchRequestListener((e,t)=>{t.scope=null!==t&&void 0!==t&&t.scope?t.scope:"Default",function(e,t,n,i){console.log(e);const s=t.getVersion(e.item);if(void 0===s)return void console.warn("Received task switch request to unknown item ".concat(e.item,". We ignored the request."));const r=n.findCompatiblePlayer(s);if(void 0===r)return void console.warn("Received task switch request to item ".concat(e.item," with version ").concat(s," and could not find a compatible task player. We ignored the request."));n.doToAll(e=>{L(e)}),!i||n.doToAll(e=>d(e,{eventType:"clearTasksState"}));n.show(r.id),R(e,r.frameWindow)}({item:t.item,task:t.task,scope:t.scope},i,n,null===t||void 0===t?void 0:t.clearState)}),e.setShinyPreloadStateListener((e,s)=>{var r;const o=null!==s&&void 0!==s&&s.item?s.item:null===(r=t.firstTask())||void 0===r?void 0:r.firstTask;if(!o)return;const a=i.getVersion(o.item);if(void 0===a)return void console.warn("Received task switch request to unknown item ".concat(o.item,". We ignored the request."));const c=n.findCompatiblePlayer(a);void 0!==c?(n.doToAll(e=>L(e)),d(c.frameWindow,{eventType:"preloadTasksState",state:null===s||void 0===s?void 0:s.state}),n.show(c.id),R(o,c.frameWindow)):console.warn("Received task switch request to item ".concat(o.item," with version ").concat(a," and could not find a compatible task player. We ignored the request."))}),e.setLoginDialogClosedListener((e,r)=>{n.doToAll(e=>S(r,e)),n.doToAll(e=>T(e)),u().then(e=>{if(e.tasks.length<1)throw new Error("No tasks declared in assessment configuration ".concat(e));t.initialize(e,n),k(e,s.mathJaxCdnUrl,n,i,t)}).catch(e=>{console.warn("Could not initialize assessment properly: ".concat(e.message))})}),e.setPlayerReadyListener(e=>{var r,o;n.receiveReadySignal(e),d(e,{eventType:"setTraceLogTransmissionChannel",channel:"postMessage",interval:5e3,targetOrigin:"*",targetWindowType:"parent"});let a=null!==(r=null===(o=m.a.parse(window.location.search))||void 0===o?void 0:o.userId)&&void 0!==r?r:"default";d(e,{eventType:"setTraceContextId",contextId:C()}),n.doToAll(e=>S(a.toString(),e)),n.doToAll(e=>T(e)),u().then(e=>{if(e.tasks.length<1)throw new Error("No tasks declared in assessment configuration ".concat(e));let r=Object(c.a)(Object(c.a)({},{scalingMode:"scale-up-down",alignmentHorizontal:"center",alignmentVertical:"center"}),h(["scalingMode","alignmentHorizontal","alignmentVertical"]));t.initialize(e,n),n.doToAll(e=>function(e,t){d(e,Object(c.a)({eventType:"setScalingConfiguration"},t))}(e,r)),k(e,s.mathJaxCdnUrl,n,i,t)}).catch(e=>{console.warn("Could not initialize assessment properly: ".concat(e.message))})}),e.setGetTaskStateListener((e,s)=>{var r,o;let a=i.getVersion(null!==(r=null===(o=t.currentTask)||void 0===o?void 0:o.item)&&void 0!==r?r:"");a&&n.doToAllCompatible(a,e=>{var n,i;d(e,{eventType:"getTasksState",requestId:"".concat(null===(n=t.currentTask)||void 0===n?void 0:n.item,".").concat(null===(i=t.currentTask)||void 0===i?void 0:i.task)})})}),e.setTraceLogListener((e,n)=>{var i,s;d(e,{eventType:"getScoringResult",requestId:"".concat(null===(i=t.currentTask)||void 0===i?void 0:i.item,".").concat(null===(s=t.currentTask)||void 0===s?void 0:s.task)})})}function k(e,t,n,i,s){Promise.resolve().then(()=>function(e,t,n,i){return Promise.all(e.tasks.map(e=>e.item).filter(w).filter(e=>!i.isRegistered(e)).map(e=>function(e,t,n,i){const s="../items/".concat(e);return function(e){return g("./items/".concat(e,"/config.json")).then(t=>{if(!function(e){try{return e.runtimeCompatibilityVersion&&"string"===typeof e.runtimeCompatibilityVersion&&e.name&&"string"===typeof e.name}catch(t){return!1}}(t))throw new Error("Configuration of ".concat(e," is invalid: ").concat(JSON.stringify(t)));return console.log("Received configuration of ".concat(e),t),t})}(e).then(e=>{i.register(e.name,e.runtimeCompatibilityVersion),n.doToAllCompatible(e.runtimeCompatibilityVersion,n=>d(n,{eventType:"addItem",itemConfig:e,resourcePath:"".concat(s,"/resources"),externalResourcePath:"".concat(s,"/external-resources"),libraryPathsMap:{MathJax:void 0===t?"math-jax unknown":t}}))}).catch(t=>{throw new Error("Could not download configuration for item ".concat(e,": ").concat(t.message))})}(e,t,n,i)))}(e,t,n,i)).then(()=>{const e=s.firstTask();if(void 0===e)throw new Error("Invalid task sequencer configuration blocks starting the first task.");window.postMessage(JSON.stringify({eventType:"itemsLoadedInPlayer",playerCount:n.getPlayerIds().length}),"*"),function(e,t,n){const i=n.getVersion(e.firstTask.item);if(void 0===i)throw new Error("Could not find item ".concat(e.firstTask.item,"."));const s=I(e.playerId,i,void 0,t);if(void 0===s)throw new Error("Could not find compatible player for item ".concat(e.firstTask.item," with version ").concat(i,"."));t.show(s.id),R(e.firstTask,s.frameWindow)}(e,n,i)}).catch(e=>{console.warn("Could not properly initialize items and start first task: ".concat(e.message))})}function w(e,t,n){return n.indexOf(e)===t}function T(e){d(e,{eventType:"setTaskSequencer",targetOrigin:window.location.origin,targetWindowType:"parent"})}function L(e){d(e,{eventType:"stopTask"})}function R(e,t){d(t,{eventType:"startTask",item:e.item,task:e.task,scope:e.scope}),window.postMessage(JSON.stringify({eventType:"progress_location",data:Object(c.a)({},e)}),"*")}function S(e,t){d(t,{eventType:"setUserId",id:e})}function b(e){d(e,{eventType:"showLogin",titleLabel:"Placeholder for Login",fieldLabel:"Please enter anything (nickname) ",buttonLabel:"Start"})}function C(){return Object(l.a)()}function I(e,t,n,i){if(void 0!==e&&i.isCompatibleById(t,e)){const t=i.getFrameWindow(e);if(void 0!==t)return{id:e,frameWindow:t};console.error("Unexpected failure to find frame for registered player ".concat(e,". We try to find another compatible one."))}if(void 0!==n&&i.isCompatibleById(t,n.id))return n;const s=i.findCompatiblePlayer(t);return void 0===s?void 0:{id:s.id,frameWindow:s.frameWindow}}class P{constructor(){this.currentTaskIndex="not set",this.tasks=[]}get currentTask(){return"number"===typeof this.currentTaskIndex?Object(c.a)({},this.tasks[this.currentTaskIndex]):null}initialize(e,t){this.currentTaskIndex=0,this.tasks=e.tasks}firstTask(){return this.currentTaskIndex=0,this.tasks.length<1?void 0:{firstTask:this.tasks[0]}}cancel(e){return{type:"login"}}nextTask(e){return this.switchAndReturnTask(e=>e+1,"no next task")}backTask(e){return this.switchAndReturnTask(e=>e-1,"no previous task")}goToTask(e,t){return this.switchAndReturnTask(e=>this.findMatchingTask(t),"Task ".concat(t.task," ").concat(void 0===t.item?"with item unspecified":"in item "+t.item," and in scope ").concat(t.scope," is not part of the assessment configuration."))}switchAndReturnTask(e,t){if("not set"===this.currentTaskIndex)return console.warn("Task sequencer is not initialized properly. This blocks all task switches."),{type:"blocked",reason:"Task sequencer not initialized properly."};const n=e(this.currentTaskIndex);return n<0||n>this.tasks.length-1?{type:"blocked",reason:t}:(this.currentTaskIndex=n,{type:"taskSwitch",nextTask:this.tasks[this.currentTaskIndex]})}findMatchingTask(e){return e.item?this.tasks.findIndex(t=>e.item===t.item&&e.task===t.task&&e.scope===t.scope):this.tasks.findIndex(t=>e.task===t.task&&e.scope===t.scope)}}class x{constructor(e){this.totalPlayerCount=void 0,this.players=[],this.pendingReadySignals=new Set,this.totalPlayerCount=e}registerPlayer(e,t,n,i){const s={id:e,frameWindow:t,frameRef:n,isCompatible:i,readyFlag:!1};this.players.push(s),this.applyPendingReadySignal(s),this.totalPlayerCount<this.players.length&&console.warn("Unexpected registration of another task player ".concat(e," as number ").concat(this.players.length,". Check the total player count: ").concat(this.totalPlayerCount,". We might have started the first login prematurely!")),console.info("Registered player ".concat(e))}receiveReadySignal(e){const t=this.findPlayerByWindow(e);void 0===t?this.pendingReadySignals.add(e):t.readyFlag=!0}allPlayersReady(){return this.players.length>=this.totalPlayerCount&&this.players.every(e=>e.readyFlag)}getFrameWindow(e){var t;return null===(t=this.findPlayerById(e))||void 0===t?void 0:t.frameWindow}getPlayerId(e){var t;return null===(t=this.findPlayerByWindow(e))||void 0===t?void 0:t.id}findCompatiblePlayer(e){return this.players.find(t=>t.isCompatible(e))}isCompatibleById(e,t){const n=this.findPlayerById(t);return void 0!==n&&n.isCompatible(e)}isCompatibleByWindow(e,t){const n=this.findPlayerByWindow(t);return void 0!==n&&n.isCompatible(e)}doToAll(e){this.players.forEach(t=>e(t.frameWindow))}doToAllCompatible(e,t){this.players.filter(t=>t.isCompatible(e)).forEach(e=>t(e.frameWindow))}show(e){this.players.forEach(t=>{const n=t.frameRef.current;null!==n?n.style.visibility=t.id===e?"visible":"collapse":console.warn("Cannot switch visibility for player ".concat(t.id," since frame element is null."))})}getPlayerIds(){return this.players.map(e=>e.id)}applyPendingReadySignal(e){const t=e.frameWindow;this.pendingReadySignals.has(t)&&(e.readyFlag=!0,this.pendingReadySignals.delete(t))}findPlayerByWindow(e){return this.players.find(t=>t.frameWindow===e)}findPlayerById(e){return this.players.find(t=>t.id===e)}}class q{constructor(){this.items=[]}register(e,t){this.items.push({name:e,version:t})}isRegistered(e){return void 0!==this.findByName(e)}getVersion(e){var t;return null===(t=this.findByName(e))||void 0===t?void 0:t.version}findByName(e){return this.items.find(t=>t.name===e)}}var W=n(0);function O(e){const{playerId:t,runtimeVersion:n,frameContentFile:r}=e.playerConfiguration,o=s.a.useRef(null),a=s.a.useRef(null);return Object(i.useEffect)(()=>{var i;const s=null===(i=o.current)||void 0===i?void 0:i.contentWindow;null!==s&&void 0!==s?e.playerCatalog.registerPlayer(t,s,a,e=>e===n):console.warn("Content window of task player frame is invalid!")},[e.playerCatalog,t,n]),Object(W.jsxs)("div",{className:"PlayerFrame",ref:a,style:{position:"absolute",top:"0px",left:"0px",borderStyle:"none",width:"100%",height:"100%",display:"flex",alignItems:"baseline",justifyContent:"center"},children:[!e.showPlayerInfo||Object(W.jsxs)("div",{style:{fontSize:"xx-small"},children:["Current Player: ",t,", Version: ",n]}),Object(W.jsx)("iframe",{ref:o,style:{width:"100%",height:"100%"},title:"PlayerFrame",src:"./react-runtime/".concat(r,"?eventTargetWindow=parent"),frameBorder:"0",scrolling:"no",className:"cbaframe"})]})}function j(e){const{messageReceiver:t,controllerConfiguration:n}=e,i=n.players,s=new x(i.length),r=new q;v(t,new P,s,r,n);const o=void 0===n.itemSize?768:n.itemSize.height,a=void 0===n.itemSize?1024:n.itemSize.width;return Object(W.jsx)("div",{className:"App",children:i.map(e=>Object(W.jsx)(O,{itemWidth:a,itemHeight:o,showPlayerInfo:n.showPlayerInfo,playerConfiguration:e,playerCatalog:s},e.playerId))})}g("./controller/config.json").then(e=>{if(!function(e){try{return(void 0===e.traceLogTransmission||function(e){try{return e.transmitUrl&&"string"===typeof e.transmitUrl&&e.interval&&"number"===typeof e.interval&&e.httpTimeout&&"number"===typeof e.httpTimeout}catch(t){return!1}}(e.traceLogTransmission))&&(void 0===e.mathJaxCdnUrl||e.mathJaxCdnUrl&&"string"===typeof e.mathJaxCdnUrl)&&(void 0===e.itemSize||e.itemSize.height&&"number"===typeof e.itemSize.height&&e.itemSize.width&&"number"===typeof e.itemSize.width)&&e.players&&Array.isArray(e.players)&&e.players.every(y)&&"boolean"===typeof e.showPlayerInfo}catch(t){return!1}}(e))throw new Error("Controller configuration is invalid: ".concat(JSON.stringify(e)));return console.log("Received controller configuration",e),e}).then(e=>{const t=function(){const e=new a;return e.startReceiving(),e}();o.a.render(Object(W.jsx)(s.a.StrictMode,{children:Object(W.jsx)(j,{messageReceiver:t,controllerConfiguration:e})}),document.getElementById("ee4basicsRoot"))}).catch(e=>{console.warn("Could not initialize assessment properly: ".concat(e.message))})}},[[17,1,2]]]);